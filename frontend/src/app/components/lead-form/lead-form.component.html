<div class="bg-white shadow-md p-6 rounded-lg max-w-lg mx-auto my-6">
  <h2 class="text-2xl font-bold mb-6">Submit Your Property Lead</h2>

  <!-- Success Message -->
  <div *ngIf="submitMessage" class="mb-4 p-3 bg-green-100 text-green-700 rounded">
    {{ submitMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="submitError" class="mb-4 p-3 bg-red-100 text-red-700 rounded">
    {{ submitError }}
  </div>

  <form [formGroup]="leadForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    <!-- Name Field -->
    <div>
      <label class="block text-sm font-medium mb-1">Your Name *</label>
      <input
        type="text"
        formControlName="homeownerName"
        placeholder="Enter your full name"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <span *ngIf="leadForm.get('homeownerName')?.invalid && leadForm.get('homeownerName')?.touched" 
            class="text-red-500 text-sm">
        Name is required
      </span>
    </div>

    <!-- Email Field -->
    <div>
      <label class="block text-sm font-medium mb-1">Email Address *</label>
      <input
        type="email"
        formControlName="homeownerEmail"
        placeholder="Enter your email"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <span *ngIf="leadForm.get('homeownerEmail')?.invalid && leadForm.get('homeownerEmail')?.touched" 
            class="text-red-500 text-sm">
        Valid email is required
      </span>
    </div>

    <!-- Phone Field -->
    <div>
      <label class="block text-sm font-medium mb-1">Phone Number *</label>
      <input
        type="tel"
        formControlName="homeownerPhone"
        placeholder="Enter your phone number"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <span *ngIf="leadForm.get('homeownerPhone')?.invalid && leadForm.get('homeownerPhone')?.touched" 
            class="text-red-500 text-sm">
        Phone number is required
      </span>
    </div>

    <!-- Property Address Field -->
    <div>
      <label class="block text-sm font-medium mb-1">Property Address *</label>
      <input
        type="text"
        formControlName="propertyAddress"
        placeholder="Enter property address (with postcode)"
        (change)="onPropertyAddressChange()"
        (blur)="onPropertyAddressChange()"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      />
      <span *ngIf="leadForm.get('propertyAddress')?.invalid && leadForm.get('propertyAddress')?.touched" 
            class="text-red-500 text-sm">
        Property address is required
      </span>
      
      <!-- Loading indicator for agency lookup -->
      <div *ngIf="isLookingUpAgencies" class="text-sm text-blue-600 mt-2">
        Looking up agencies for this area...
      </div>

      <!-- Suggested Agencies -->
      <div *ngIf="suggestedAgencies.length > 0" class="mt-3 p-3 bg-blue-50 rounded border border-blue-200">
        <p class="text-sm font-semibold text-blue-900 mb-2">Suggested Agencies for this area:</p>
        <div class="space-y-2">
          <button
            *ngFor="let agency of suggestedAgencies"
            type="button"
            (click)="selectAgency(agency)"
            class="w-full p-2 text-left bg-white border border-blue-300 rounded hover:bg-blue-100 transition text-sm"
          >
            <span class="font-medium">{{ agency.name }}</span>
            <br/>
            <span class="text-xs text-gray-600">{{ agency.territory }} | {{ agency.phone }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Property Type Dropdown -->
    <div>
      <label class="block text-sm font-medium mb-1">Property Type *</label>
      <select
        formControlName="propertyType"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        required
      >
        <option value="">Select Property Type</option>
        <option value="house">House</option>
        <option value="apartment">Apartment</option>
        <option value="unit">Unit</option>
        <option value="townhouse">Townhouse</option>
        <option value="land">Land</option>
        <option value="other">Other</option>
      </select>
      <span *ngIf="leadForm.get('propertyType')?.invalid && leadForm.get('propertyType')?.touched" 
            class="text-red-500 text-sm">
        Property type is required
      </span>
    </div>

    <!-- Preferred Agency (Optional) -->
    <div>
      <label class="block text-sm font-medium mb-1">Preferred Agency (Optional)</label>
      <input
        type="text"
        formControlName="preferredAgency"
        placeholder="Agency name (if any)"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>

    <!-- Preferred Contact Time (Optional) -->
    <div>
      <label class="block text-sm font-medium mb-1">Best Call Time (Optional)</label>
      <input
        type="text"
        formControlName="preferredContactTime"
        placeholder="e.g., Evenings 5-8pm"
        class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>

    <!-- Submit Button -->
    <button
      type="submit"
      [disabled]="isSubmitting"
      class="bg-blue-600 text-white p-3 rounded hover:bg-blue-700 disabled:bg-gray-400 transition font-semibold"
    >
      {{ isSubmitting ? 'Submitting...' : 'Submit Lead' }}
    </button>
  </form>
</div>
