<section class="lead-form-container">
  <div class="lead-form-card">
    <div class="form-header">
      <h2 class="form-title">Get your free appraisal</h2>
      <p class="form-subtitle">Tell us a little about your home.</p>
      <p class="form-note">
        After you submit, you can log in anytime to view agent offers.
      </p>
    </div>

      <!-- Success Message -->
      <div *ngIf="submitMessage" class="alert alert-success">
        {{ submitMessage }}
      </div>

      <!-- Error Message -->
      <div *ngIf="submitError" class="alert alert-error">
        {{ submitError }}
      </div>

      <form [formGroup]="leadForm" (ngSubmit)="onSubmit()" class="form-content">
        <!-- Name Field -->
        <div class="form-group">
          <label class="form-label">Your name <span>*</span></label>
          <input
            type="text"
            formControlName="homeownerName"
            placeholder="Enter your full name"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('homeownerName')?.invalid && leadForm.get('homeownerName')?.touched"
            class="form-error"
          >
            Name is required
          </span>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label class="form-label">Email address <span>*</span></label>
          <input
            type="email"
            formControlName="homeownerEmail"
            placeholder="Enter your email"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('homeownerEmail')?.invalid && leadForm.get('homeownerEmail')?.touched"
            class="form-error"
          >
            Valid email is required
          </span>
        </div>

        <!-- Phone Field -->
        <div class="form-group">
          <label class="form-label">Phone number <span>*</span></label>
          <input
            type="tel"
            formControlName="homeownerPhone"
            placeholder="Enter your phone number"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('homeownerPhone')?.invalid && leadForm.get('homeownerPhone')?.touched"
            class="form-error"
          >
            Phone number is required
          </span>
        </div>

        <!-- Property Address Field -->
        <div class="form-group">
          <label class="form-label">Property address <span>*</span></label>
          <input
            type="text"
            formControlName="propertyAddress"
            placeholder="Enter property address with postcode"
            (change)="onPropertyAddressChange()"
            (blur)="onPropertyAddressChange()"
            #propertyAddressInput
            autocomplete="off"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('propertyAddress')?.invalid && leadForm.get('propertyAddress')?.touched"
            class="form-error"
          >
            Property address is required
          </span>

          <!-- Loading indicator for agency lookup -->
          <div *ngIf="isLookingUpAgencies" class="agency-loading">
            Looking up agencies for this area...
          </div>

          <!-- Suggested Agencies -->
          <div *ngIf="suggestedAgencies.length > 0" class="agencies-suggestion">
            <p class="agencies-title">Suggested agencies for your area</p>
            <div class="agencies-list">
              <button
                *ngFor="let agency of suggestedAgencies"
                type="button"
                (click)="selectAgency(agency)"
                class="agency-button"
              >
                <span class="agency-name">{{ agency.name }}</span>
                <span class="agency-details">{{ agency.territory }} | {{ agency.phone }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Property Type Dropdown -->
        <div class="form-group">
          <label class="form-label">Property type <span>*</span></label>
          <select formControlName="propertyType" class="form-input" required>
            <option value="">Select property type</option>
            <option value="house">House</option>
            <option value="apartment">Apartment</option>
            <option value="unit">Unit</option>
            <option value="townhouse">Townhouse</option>
            <option value="land">Land</option>
            <option value="other">Other</option>
          </select>
          <span
            *ngIf="leadForm.get('propertyType')?.invalid && leadForm.get('propertyType')?.touched"
            class="form-error"
          >
            Property type is required
          </span>
        </div>

        <!-- Preferred Agency (Optional) -->
        <div class="form-group">
          <label class="form-label">Preferred agency (optional)</label>
          <input
            type="text"
            formControlName="preferredAgency"
            placeholder="Agency name (if any)"
            class="form-input"
          />
        </div>

        <!-- Preferred Contact Time (Optional) -->
        <div class="form-group">
          <label class="form-label">Best time to call (optional)</label>
          <input
            type="text"
            formControlName="preferredContactTime"
            placeholder="e.g., Evenings 5-8pm"
            class="form-input"
          />
        </div>

        <!-- Password -->
        <div class="form-group">
          <label class="form-label">Create a password <span>*</span></label>
          <input
            type="password"
            formControlName="password"
            placeholder="At least 8 characters"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('password')?.invalid && leadForm.get('password')?.touched"
            class="form-error"
          >
            Password must be at least 8 characters
          </span>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label class="form-label">Confirm password <span>*</span></label>
          <input
            type="password"
            formControlName="confirmPassword"
            placeholder="Re-enter your password"
            class="form-input"
            required
          />
          <span
            *ngIf="leadForm.get('confirmPassword')?.invalid && leadForm.get('confirmPassword')?.touched"
            class="form-error"
          >
            Please confirm your password
          </span>
        </div>

        <!-- Submit Button -->
        <button type="submit" [disabled]="isSubmitting" class="btn btn-primary">
          {{ isSubmitting ? 'Submitting...' : 'Get My Appraisal' }}
        </button>

        <p class="form-disclaimer">
          This is not a formal valuation. We will connect you with licensed agents.
        </p>
    </form>
  </div>
</section>
